{% extends "base.html" %} {% block title %}Problems{% endblock %} {% block
content %}
<script
  type="text/javascript"
  src="{{ url_for('static', filename='js/value2str.js') }}"
></script>
<script
  type="text/javascript"
  src="{{ url_for('static', filename='js/index.js') }}"
></script>
<div class="ui container">
  <div class="ui toggle checkbox" style="margin-top: 20px">
    <input type="checkbox" id="use-median" />
    <label>Use Median</label>
  </div>
  <div class="column" style="margin-top: 20px">
    <table class="ui left aligned table" id="problems-table">
      <thead>
        <th>Pid</th>
        <th id="contest-header">Contest ▾</th>
        <th>Name</th>
        <th id="difficulty-header">Difficulty ▴</th>
        <th id="quality-header">Quality ▴</th>
        <th>Vote</th>
        <th>Show Votes</th>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="ui modal" id="vote">
    <div class="header">Vote</div>
    <div class="content">
      <div class="ui labeled input" style="margin-right: 10px">
        <div class="ui label">Difficulty(800-3500)</div>
        <input
          type="number"
          placeholder="Difficulty"
          data-tribute="true"
          id="difficulty"
        />
      </div>
      <div class="ui labeled input">
        <div class="ui label">Quality(1-5)</div>
        <input
          type="number"
          placeholder="Quality"
          data-tribute="true"
          id="quality"
        />
      </div>
      <div class="ui labeled input">
        <div class="ui label">Comment</div>
        <input
          type="text"
          placeholder="Comment"
          data-tribute="true"
          id="comment"
        />
      </div>
    </div>
    <div class="actions">
      <div class="ui black deny button">Cancel</div>
      <div class="ui positive button">Save</div>
    </div>
  </div>
  <div class="ui modal" id="show-votes">
    <div class="header">Show Votes</div>
    <div class="content">
      <table class="ui left aligned table" id="vote-table">
        <thead>
          <th>Difficulty</th>
          <th>Quality</th>
          <th>Comments</th>
          <th>Report</th>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="actions">
      <div class="ui positive button">OK</div>
    </div>
  </div>
  <div class="ui modal" id="details">
    <div class="header">Details</div>
    <div class="content">
      <ul class="ui list"></ul>
    </div>
    <div class="actions">
      <div class="ui positive button">OK</div>
    </div>
  </div>
</div>
<script>
  $(document).ready(function () {
    $.ajax({
      url: '/backend/get_problems',
      type: 'GET',
      success: function (data) {
        window.data = data;
        sortData('contest');
        showTable();
      },
    });

    $('#contest-header').click(function () {
      $('#contest-header').text('Contest ▾');
      $('#difficulty-header').text('Difficulty ▴');
      $('#quality-header').text('Quality ▴');
      sortData('contest');
    });

    $('#difficulty-header').click(function () {
      $('#contest-header').text('Contest ▴');
      $('#difficulty-header').text('Difficulty ▾');
      $('#quality-header').text('Quality ▴');
      sortData('difficulty');
    });

    $('#quality-header').click(function () {
      $('#contest-header').text('Contest ▴');
      $('#difficulty-header').text('Difficulty ▴');
      $('#quality-header').text('Quality ▾');
      sortData('quality');
    });

    $('#use-median').click(function () {
      for (let i = 0; i < data.length; i++) {
        [data[i]['difficulty'], data[i]['difficulty2']] = [
          data[i]['difficulty2'],
          data[i]['difficulty'],
        ];
        [data[i]['quality'], data[i]['quality2']] = [
          data[i]['quality2'],
          data[i]['quality'],
        ];
      }
      showTable();
    });

    $('#vote .positive.button').click(function () {
      let difficulty = $('#difficulty').val();
      let quality = $('#quality').val();
      let comment = $('#comment').val();
      if (difficulty < 800 || difficulty > 3500) {
        difficulty = -1;
      }
      if (quality < 1 || quality > 5) {
        quality = -1;
      }
      $.ajax({
        url: '/backend/vote/',
        type: 'POST',
        data: {
          pid: window.pid,
          difficulty: difficulty,
          quality: quality,
          comment: comment,
        },
        success: function (data) {
          location.reload();
        },
      });
    });
  });
</script>
{% endblock %}
