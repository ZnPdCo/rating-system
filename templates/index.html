<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>{{ title }}</title>

    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='semantic/semantic.min.css') }}">
    <script type="text/javascript" src="{{ url_for('static', filename='jquery/jquery.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='semantic/semantic.min.js') }}"></script>

    <script>
        $(document).ready(function () {
            $(`.menu a[href="${location.pathname}"]`).addClass('active');
        });
    </script>
</head>

<body>
    <div class="ui menu">
        <div class="header item">{{title}}</div>
        <a class="item" href="/">Problems</a>
        <a class="item" href="/legal/">Legal</a>
        {% if is_admin == True %}<a class="item" href="/admin/">Admin</a>{% endif %}
        <div class="right menu">
            {% if logged_in == False %}<a class="item" href="/login/">Login</a>{% endif %}
            {% if logged_in == True %}<a class="item" href="/logout/">Logout</a>{% endif %}
        </div>
    </div>
    <div class="ui container">
        <div class="ui toggle checkbox" style="margin-top: 20px;">
            <input type="checkbox" id="use-median" onclick="showTable()">
            <label>Use Median</label>
        </div>
        <div class="column" style="margin-top: 20px;">
            <table class="ui left aligned table" id="problems-table">
                <thead>
                    <th>Pid</th>
                    <th id="contest-header">Contest ▾</th>
                    <th>Name</th>
                    <th id="difficulty-header">Difficulty ▴</th>
                    <th id="quality-header">Quality ▴</th>
                    <th>Vote</th>
                    <th>Show Votes</th>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <div class="ui modal" id="vote">
            <div class="header">
                Vote
            </div>
            <div class="content">
                <div class="ui labeled input" style="margin-right: 10px;">
                    <div class="ui label">
                        Difficulty(800-3500)
                    </div>
                    <input type="number" placeholder="Difficulty" data-tribute="true" id="difficulty">
                </div>
                <div class="ui labeled input">
                    <div class="ui label">
                        Quality(0-5)
                    </div>
                    <input type="number" placeholder="Quality" data-tribute="true" id="quality">
                </div>
            </div>
            <div class="actions">
                <div class="ui black deny button">
                    Cancel
                </div>
                <div class="ui positive button">
                    Save
                </div>
            </div>
        </div>
        <div class="ui modal" id="show-votes">
            <div class="header">
                Show Votes
            </div>
            <div class="content">
                <table class="ui left aligned table" id="vote-table">
                    <thead>
                        <th>Difficulty</th>
                        <th>Quality</th>
                        <th>Comments</th>
                        <th>Report</th>
                    </thead>
                    <tbody>
                        <tr>
                            <td>a</td>
                            <td>a</td>
                            <td>a</td>
                            <td>a</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="actions">
                <div class="ui positive button">
                    OK
                </div>
            </div>
        </div>
    </div>
    <script>
        function rating2Str(rating, cnt) {
            var res = '<td style="';
            if (rating >= 2400) {
                res += 'color: red;';
            } else if (rating >= 2100) {
                res += 'color: rgb(255,140,0);';
            } else if (rating >= 0) {
                res += 'color: rgb(170,0,170);';
            } else if (rating >= 1600) {
                res += 'color: blue;';
            } else if (rating >= 1400) {
                res += 'color: rgb(3,168,158);';
            } else if (rating >= 1200) {
                res += 'color: green;';
            } else if (rating >= 1000) {
                res += 'color: rgb(136,204,34);';
            } else {
                res += 'color: gray;';
            }
            res += `font-weight: 500;" data-toggle="popover" data-content="Number of votes: ${cnt}" data-original-title="" title=""> ${rating2Circle(rating)}${(rating == null ? 'N/A' : Math.round(rating))}</td>`;
            return res;
        }

        function rating2Circle(rating) {
            var percentage = 0;
            var col = "";
            if (rating >= 2400) {
                col += 'red';
                percentage = (rating - 2400) / 9;
            } else if (rating >= 2100) {
                col += 'rgb(255,140,0)';
                percentage = (rating - 2100) / 3;
            } else if (rating >= 0) {
                col += 'rgb(170,0,170)';
                percentage = (rating - 0) / 2;
            } else if (rating >= 1600) {
                col += 'blue';
                percentage = (rating - 1600) / 3;
            } else if (rating >= 1400) {
                col += 'rgb(3,168,158)';
                percentage = (rating - 1400) / 2;
            } else if (rating >= 1200) {
                col += 'green';
                percentage = (rating - 1200) / 2;
            } else if (rating >= 1000) {
                col += 'rgb(136,204,34)';
                percentage = (rating - 1000) / 2;
            } else {
                col += 'gray';
                percentage = (rating) / 10;
            }
            percentage = Math.round(10 * percentage) / 10;
            var res = `<span style="display: inline-block; 
                                    border-radius: 50%; 
                                    border-style: solid;
                                    border-width: 1px;
                                    margin-right: 5px;
                                    height: 12px;
                                    width: 12px;
                                    border-color: ${col};
                                    background: linear-gradient(to top, ${col} 0%, ${col} ${percentage}%, rgba(0, 0, 0, 0) ${percentage}%, rgba(0, 0, 0, 0) 100%);"></span>`;
            return res;
        }

        function quality2Str(quality, cnt) {
            var showQuality = Math.round(quality * 10) / 10;
            var res = '<td style="';
            if (quality == null) {
                res += 'color: gray;';
                showQuality = "N/A";
            } else {
                quality = Math.round(quality);
                if (quality == 1) {
                    res += 'color: gray;';
                } else if (quality == 2) {
                    res += 'color: rgb(144, 238, 144);';
                } else if (quality == 3) {
                    res += 'color: rgb(80, 200, 120);';
                } else if (quality == 4) {
                    res += 'color: rgb(34, 139, 34);';
                } else {
                    res += 'color: rgb(0, 128, 0);';
                }
            }
            res += `font-weight: 500;" data-toggle="popover" data-content="Number of votes: ${cnt}" data-original-title="" title="">${showQuality}</td>`;
            return res;
        }
        function showTable() {
            let table = $('#problems-table tbody');
            table.empty();
            for (let i = 0; i < data.length; i++) {
                let row = $('<tr>');
                row.append($('<td>').text(data[i]['id']));
                row.append($('<td>').text(data[i]['contest']));
                row.append($('<td>').html(data[i]['name']));
                row.append(rating2Str(data[i]['rating']));
                row.append(quality2Str(data[i]['quality']));
                row.append($('<td>').text(""));
                row.append($('<td>').text(""));
                table.append(row);
            }
        }
        $(document).ready(function () {
            $.ajax({
                url: '/backend/get_problems',
                type: 'GET',
                success: function (data) {
                    window.data = data;
                    showTable();
                }
            });

            $('#contest-header').click(function () {
                $('#contest-header').text('Contest ▾')
                $('#difficulty-header').text('Difficulty ▴')
                $('#quality-header').text('Quality ▴')
                data.sort(function (a, b) {
                    if (a['contest'] > b['contest']) {
                        return -1;
                    } else if (a['contest'] < b['contest']) {
                        return 1;
                    } else {
                        return 0;
                    }
                });
                showTable();
            });

            $('#difficulty-header').click(function () {
                $('#contest-header').text('Contest ▴')
                $('#difficulty-header').text('Difficulty ▾')
                $('#quality-header').text('Quality ▴')
                data.sort(function (a, b) {
                    if (a['rating'] == null && b['rating'] == null) {
                        return 0;
                    }
                    if (a['rating'] == null) {
                        return 1;
                    }
                    if (b['rating'] == null) {
                        return -1
                    }
                    if (a['rating'] > b['rating']) {
                        return -1;
                    } else if (a['rating'] < b['rating']) {
                        return 1;
                    } else {
                        return 0;
                    }
                });
                showTable();
            });

            $('#quality-header').click(function () {
                $('#contest-header').text('Contest ▴')
                $('#difficulty-header').text('Difficulty ▴')
                $('#quality-header').text('Quality ▾')
                data.sort(function (a, b) {
                    if (a['quality'] == null && b['quality'] == null) {
                        return 0;
                    }
                    if (a['quality'] == null) {
                        return 1;
                    }
                    if (b['quality'] == null) {
                        return -1
                    }
                    if (a['quality'] > b['quality']) {
                        return -1;
                    } else if (a['quality'] < b['quality']) {
                        return 1;
                    } else {
                        return 0;
                    }
                });
                showTable();
            });
        });
    </script>
</body>

</html>